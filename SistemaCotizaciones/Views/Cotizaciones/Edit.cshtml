@model CotizacionCreateViewModel

@{
    ViewData["Title"] = "Modificar";
    Layout = "~/Views/Shared/_LayoutCotizacion.cshtml";
}

<style>
    .visible {
        display: table-row;
    }

    .oculta {
        display: none;
    }

    .form-control {
        font-size: smaller;
        height: calc(1.5em + .75rem + 2px);
    }


    .dropdown-menu {
        padding: 0px 1px !important;
        margin: 0px !important;
        font-size: small;
    }

    .filter-option-inner {
        padding: 0px 1px !important;
        margin: 0px !important;
        font-size: smaller;
    }

    .bs-placeholder, .dropdown-toggle {
        color: #495057 !important;
        border: 1px solid #ced4da;
        height: calc(1.5em + .5rem + 2px);
        background-color: #fff;
    }

    #tablaMateriales tr, #tablaMateriales td, #tablaMateriales th {
        padding: 0;
    }

    #tablaMateriales input[type='number'] {
        text-align: right;
    }

    #tablaMateriales input, #tablaMateriales select {
        padding: 0px 1px !important;
        margin: 0px !important;
        height: calc(1em + .5rem + 2px);
        font-size: small;
    }

    #tablaMateriales .bs-placeholder, #tablaMateriales .dropdown-toggle {
        padding: 0px 1px !important;
        margin: 0px !important;
        color: #495057 !important;
        border: 1px solid #ced4da;
        height: calc(1em + .35rem);
        background-color: #fff;
        max-width: 300px;
    }

    #tablaMateriales .bootstrap-select, #tablaMateriales .td-selectpicker {
        max-width: 300px !important;
    }
</style>

<h2>Modificar cotización</h2>

<hr />
<form id="formCotizacion" asp-action="Edit" class="row">
    <input type="hidden" asp-for="Cotizacion.CotizacionId" />
    <input type="hidden" asp-for="Cotizacion.Version" />
    <input type="hidden" asp-for="Quote.QuoteId" />
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="col-md-4 col-sm-12">
        <div class="row p-0">
            <div class="form-group col-md-6 col-sm-12">
                <label asp-for="Quote.NumeroQuote" class="control-label"></label>
                <input asp-for="Quote.NumeroQuote" class="form-control" readonly />
                <span asp-validation-for="Quote.NumeroQuote" class="text-danger"></span>
            </div>
            <div class="form-group col-md-6 col-sm-12">
                <label asp-for="Quote.FechaEmision" class="control-label"></label>
                <input type="date" asp-for="Quote.FechaEmision" class="form-control" />
                <span asp-validation-for="Quote.FechaEmision" class="text-danger"></span>
            </div>
            <div class="form-group col-md-12 col-sm-12">
                <label asp-for="Quote.FabricanteId" class="control-label"></label>
                <select asp-for="Quote.FabricanteId" class="form-control selectpicker" data-live-search="true" asp-items="ViewBag.FabricanteId">
                    <option value="">Seleccione fabricante</option>
                </select>
                <span asp-validation-for="Quote.FabricanteId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-12 col-sm-12">
                <label asp-for="Quote.ContactoFabricanteId" class="control-label"></label>
                <select asp-for="Quote.ContactoFabricanteId" class="form-control selectpicker" data-live-search="true" asp-items="ViewBag.ContactoFabricanteId">
                    <option value="">Seleccione contacto</option>
                </select>
                <span asp-validation-for="Quote.ContactoFabricanteId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-12 col-sm-12">
                <label asp-for="Quote.NombreOportunidad" class="control-label"></label>
                <input asp-for="Quote.NombreOportunidad" class="form-control" />
                <span asp-validation-for="Quote.NombreOportunidad" class="text-danger"></span>
            </div>
        </div>
    </div>
    <div class="col-md-8 col-sm-12">
        <div class="row p-0">
            <div class="form-group col-md-4 col-sm-12">
                <label asp-for="Cotizacion.UsuarioId" class="control-label"></label>
                <select asp-for="Cotizacion.UsuarioId" class="form-control" asp-items="ViewBag.UsuarioId">
                    <option value="">Seleccione usuario</option>
                </select>
                <span asp-validation-for="Cotizacion.UsuarioId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-4 col-sm-12">
                <label asp-for="Cotizacion.TipoCotizacionId" class="control-label"></label>
                <select asp-for="Cotizacion.TipoCotizacionId" class="form-control" asp-items="ViewBag.TipoCotizacionId">
                    <option value="">Seleccione tipo de cotización</option>
                </select>
                <span asp-validation-for="Cotizacion.TipoCotizacionId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-4 col-sm-12">
                <label asp-for="Cotizacion.TipoCompraId" class="control-label"></label>
                <select asp-for="Cotizacion.TipoCompraId" class="form-control" asp-items="ViewBag.TipoCompraId">
                    <option value="">Seleccione tipo de compra</option>
                </select>
                <span asp-validation-for="Cotizacion.TipoCompraId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-6 col-sm-12">
                <label asp-for="Cotizacion.CanalId" class="control-label"></label>
                <select asp-for="Cotizacion.CanalId" class="form-control selectpicker" data-live-search="true" asp-items="ViewBag.CanalId">
                    <option value="">Seleccione canal</option>
                </select>
                <span asp-validation-for="Cotizacion.CanalId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-6 col-sm-12">
                <label asp-for="Cotizacion.ContactoCanalId" class="control-label"></label>
                <select asp-for="Cotizacion.ContactoCanalId" class="form-control selectpicker" data-live-search="true" asp-items="ViewBag.ContactoCanalId">
                    <option value="">Seleccione contacto</option>
                </select>
                <span asp-validation-for="Cotizacion.ContactoCanalId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-6 col-sm-12">
                <label asp-for="Cotizacion.ClienteFinalId" class="control-label"></label>
                <select asp-for="Cotizacion.ClienteFinalId" class="form-control selectpicker" data-live-search="true" asp-items="ViewBag.ClienteFinalId">
                    <option value="">Seleccione cliente final</option>
                </select>
                <span asp-validation-for="Cotizacion.ClienteFinalId" class="text-danger"></span>
            </div>
            <div class="form-group col-md-6 col-sm-12">
                <label asp-for="Cotizacion.ContactoClienteFinalId" class="control-label"></label>
                <select asp-for="Cotizacion.ContactoClienteFinalId" class="form-control selectpicker" data-live-search="true" asp-items="ViewBag.ContactoClienteFinalId">
                    <option value="">Seleccione contacto</option>
                </select>
                <span asp-validation-for="Cotizacion.ContactoClienteFinalId" class="text-danger"></span>
            </div>
            @{
                var margen = Model.Cotizacion.Margen.ToString().Replace(",",".");
            }
            <div class="form-group col-md-2 col-sm-12">
                <label asp-for="Cotizacion.Margen" class="control-label"></label>
                <input type="number" min="0" step="0.01" value="@margen" asp-for="Cotizacion.Margen" class="form-control" />
                <span asp-validation-for="Cotizacion.Margen" class="text-danger"></span>
            </div>
            <div class="form-group col-md-10 col-sm-12">
                <label asp-for="Cotizacion.Observaciones" class="control-label"></label>
                <textarea asp-for="Cotizacion.Observaciones" class="form-control"></textarea>
            </div>
        </div>
    </div>

    <div class="col-md-12 col-sm-12">
        <table id="tablaMateriales" class="table table-condensed table-striped table-bordered small">
            <tr>
                <th></th>
                <th>MATERIAL</th>
                <th class="text-center">SW/HW</th>
                <th class="text-center" style="min-width:200px;">S/N</th>
                <th class="text-right">CANT</th>
                <th class="text-right">PRECIO[$]</th>
                <th class="text-right">DESC[%]</th>
                <th class="text-right">IMP/DUTY[%]</th>
                <th class="text-right">CLIENTE[$]</th>
                <th class="text-center">INICIO</th>
                <th class="text-center">TÉRMINO</th>
                <th class="text-right">TOTAL NETO</th>
                <th></th>
            </tr>
            @{
                var nCotizaciones = Model.Cotizacion.MaterialesCotizacion.Where(c => c.TotalNeto != null).ToList().Count;

                for (int i = 1; i <= nCotizaciones; i++)
                {
                    var idDelete = Model.Cotizacion.MaterialesCotizacion[i - 1].MaterialCotizacionId;
                    var skuDelete = Model.Cotizacion.MaterialesCotizacion[i - 1].Material.Sku;

                    var prec = Model.Cotizacion.MaterialesCotizacion[i - 1].PrecioUnitario.ToString().Replace(",", ".");
                    var desc = Model.Cotizacion.MaterialesCotizacion[i - 1].DescuentoPorcentaje.ToString().Replace(",", ".");
                    var impt = Model.Cotizacion.MaterialesCotizacion[i - 1].ImpuestoDuty.ToString().Replace(",", ".");
                    var clie = Model.Cotizacion.MaterialesCotizacion[i - 1].PrecioCliente.ToString().Replace(",", ".");
                    var totl = Model.Cotizacion.MaterialesCotizacion[i - 1].TotalNeto.ToString().Replace(",", ".");

                    <tr id="tr_@i" class="visible">
                        <input type="hidden" asp-for="Cotizacion.MaterialesCotizacion[i-1].MaterialCotizacionId" />
                        <td class="text-right">@i</td>
                        <td class="td-selectpicker">
                            <select asp-for="Cotizacion.MaterialesCotizacion[i-1].MaterialId" class="form-control small selectpicker mMaterial" data-live-search="true" asp-items="ViewBag.Materiales">
                                <option value="">Seleccione</option>
                            </select>
                        </td>
                        <td>
                            <select asp-for="Cotizacion.MaterialesCotizacion[i-1].TipoMaterial" class="form-control small mTipo">
                                <option value="SW">SW</option>
                                <option value="HW">HW</option>
                                <option value="SW-BT">SW-BT</option>
                                <option value="HW-BT">HW-BT</option>
                            </select>
                        </td>
                        <td><input asp-for="Cotizacion.MaterialesCotizacion[i-1].NumeroSerie" class="form-control small mNumeroSerie" style="text-transform:uppercase" /></td>
                        <td><input type="number" min="0" step="1" asp-for="Cotizacion.MaterialesCotizacion[i-1].Cantidad" onkeypress="return soloNumeros(event);" class="form-control small mCantidad" /></td>
                        <td><input type="number" min="0" step="0.01" value="@prec" asp-for="Cotizacion.MaterialesCotizacion[i-1].PrecioUnitario" onkeypress="return soloNumpunto(event);" class="form-control small mPrecioUnitario decimal" /></td>
                        <td><input type="number" min="0" step="0.01" value="@desc" asp-for="Cotizacion.MaterialesCotizacion[i-1].DescuentoPorcentaje" class="form-control small mDescuento" /></td>
                        <td><input type="number" min="0" step="0.01" value="@impt" asp-for="Cotizacion.MaterialesCotizacion[i-1].ImpuestoDuty" onkeypress="return soloNumpunto(event);" class="form-control small mImpuesto" /></td>
                        <td><input type="number" min="0" step="0.01" value="@clie" asp-for="Cotizacion.MaterialesCotizacion[i-1].PrecioCliente" readonly class="form-control small mPrecioCliente decimal" /></td>
                        <td><input type="date" asp-for="Cotizacion.MaterialesCotizacion[i-1].FechaInicio" class="form-control small" /></td>
                        <td><input type="date" asp-for="Cotizacion.MaterialesCotizacion[i-1].FechaTermino" class="form-control small" /></td>
                        <td><input type="number" min="0" step="0.01" value="@totl" asp-for="Cotizacion.MaterialesCotizacion[i-1].TotalNeto" readonly class="form-control small mTotalNeto text-primary decimal" /></td>
                        <td><button type="button" class="text-danger border-0" onclick="deleteMaterial('@idDelete','@skuDelete')"><i class="fas fa-trash-alt"></i></button></td>
                    </tr>
                }
                for (int i = nCotizaciones + 1; i < 90; i++)
                {
                    <tr id="tr_@i" class="oculta">
                        <td class="text-right">@i</td>
                        <td class="td-selectpicker">
                            <select asp-for="Cotizacion.MaterialesCotizacion[i-1].MaterialId" class="form-control small selectpicker mMaterial" data-live-search="true" asp-items="ViewBag.Materiales">
                                <option value="">Seleccione</option>
                            </select>
                        </td>
                        <td>
                            <select asp-for="Cotizacion.MaterialesCotizacion[i-1].TipoMaterial" class="form-control small mTipo">
                                <option value="SW">SW</option>
                                <option value="HW">HW</option>
                                <option value="SW-BT">SW-BT</option>
                                <option value="HW-BT">HW-BT</option>
                            </select>
                        </td>
                        <td><input asp-for="Cotizacion.MaterialesCotizacion[i-1].NumeroSerie" class="form-control small mNumeroSerie" style="text-transform:uppercase" /></td>
                        <td><input type="number" min="0" step="1" asp-for="Cotizacion.MaterialesCotizacion[i-1].Cantidad" onkeypress="return soloNumeros(event);" class="form-control small mCantidad" /></td>
                        <td><input type="number" min="0" step="0.01" asp-for="Cotizacion.MaterialesCotizacion[i-1].PrecioUnitario" onkeypress="return soloNumpunto(event);" class="form-control small mPrecioUnitario decimal" /></td>
                        <td><input type="number" min="0" step="0.01" asp-for="Cotizacion.MaterialesCotizacion[i-1].DescuentoPorcentaje" class="form-control small mDescuento" /></td>
                        <td><input type="number" min="0" step="0.01" asp-for="Cotizacion.MaterialesCotizacion[i-1].ImpuestoDuty" onkeypress="return soloNumpunto(event);" class="form-control small mImpuesto" /></td>
                        <td><input type="number" min="0" step="0.01" asp-for="Cotizacion.MaterialesCotizacion[i-1].PrecioCliente" readonly class="form-control small mPrecioCliente decimal" /></td>
                        <td><input type="date" asp-for="Cotizacion.MaterialesCotizacion[i-1].FechaInicio" class="form-control small" /></td>
                        <td><input type="date" asp-for="Cotizacion.MaterialesCotizacion[i-1].FechaTermino" class="form-control small" /></td>
                        <td><input type="number" min="0" step="0.01" asp-for="Cotizacion.MaterialesCotizacion[i-1].TotalNeto" readonly class="form-control small mTotalNeto text-primary decimal" /></td>
                        <td></td>
                    </tr>
                }
            }
            <tr>
                <td colspan="13" class="text-left">
                    <button type="button" class="btn btn-success" onclick="addRow();"><i class="fas fa-plus-circle"></i></button>
                </td>
            </tr>
        </table>
    </div>

    @{
        var totlNeto = Model.Cotizacion.TotalNeto.ToString().Replace(",", ".");
        var totlIva = Model.Cotizacion.TotalNeto.ToString().Replace(",", ".");
    }

    <div class="form-group col-md-2 offset-md-10 col-sm-12 text-right">
        <label asp-for="Cotizacion.TotalNeto" class="control-label"></label>
        <input asp-for="Cotizacion.TotalNeto" value="@totlNeto" readonly class="form-control text-primary text-right p-1" />
    </div>
    <div class="form-group col-md-2 offset-md-10 col-sm-12 text-right">
        <label asp-for="Cotizacion.TotalIVA" class="control-label"></label>
        <input asp-for="Cotizacion.TotalIVA" value="@totlIva" readonly class="form-control text-success text-right p-1" />
    </div>
    <div class="form-group col-md-12 col-sm-12 text-right">
        <button type="button" value="Guardar Version" class="btn btn-success" onclick="GuardaVersion();">Guardar Versión</button>
        <input type="submit" value="Guardar" class="btn btn-primary" />
    </div>
</form>

<div>
    <a asp-action="Index">Volver al listado</a>
</div>

<!-- Modal -->
<div class="modal fade" id="modalDelete" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form asp-action="MaterialDelete" class="modal-content">
            <input type="hidden" id="id-delete" name="id" />
            <input type="hidden" value="@Model.Cotizacion.CotizacionId" name="idCotizacion" />
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Eliminar</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                ¿Está seguro de que desea eliminar este ítem?
                <p id="sku-delete" class="text-primary"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <input type="submit" class="btn btn-danger" value="Eliminar" />
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/js/validaciones.js"></script>
<script>

    function GuardaVersion() {
        $("#formCotizacion").attr("action","/Cotizaciones/GuardaVersion");
        $("#formCotizacion").submit();
    }

    function deleteMaterial(id, sku) {
        $("#id-delete").val(id);
        $("#sku-delete").html(sku);

        $("#modalDelete").modal("show");
    }

    $(document).ready(function () {
        $("#formCotizacion").submit(function () {
            return true;
        });
    });

    function CalculaTotales() {
        var total = 0;
        for (i = 1; i < 90; i++) {
            var tr = $("#tr_" + i);

            if (tr.hasClass("visible")) {
                //console.log(tr.attr("id"));
                if (tr.find(".mTotalNeto").val() != "" && tr.find(".mTotalNeto").val() != undefined) {
                    var trVal = tr.find(".mTotalNeto").val();
                    //console.log(trVal);
                    total = parseFloat(total) + parseFloat(trVal);
                    //console.log(total);
                }
            }
        }
        total = parseFloat(total).toFixed(2);
        $("#Cotizacion_TotalNeto").val(total);
        $("#Cotizacion_TotalIVA").val((total * 1.19).toFixed(2));

        //console.log("Total = " + $("#Cotizacion_TotalNeto").val());
    }

    function CalculaPrecio(rowId) {
        var tr = $("#tr_" + rowId);
        var tipo = tr.find(".mTipo").val();
        var cantidad = parseFloat(tr.find(".mCantidad").val());
        var precioUnitario = parseFloat(tr.find(".mPrecioUnitario").val());
        var descuento = parseFloat(tr.find(".mDescuento").val());
        var impuesto = parseFloat(tr.find(".mImpuesto").val());

        var margen = parseFloat($("#Cotizacion_Margen").val());

        if (tipo != "") {
            var precioCliente = 0;
            var totalNeto = 0;

            var precioFoB = precioUnitario * (1 - descuento / 100);

            //console.log("Precio FoB = " + precioUnitario + "* (1 - " + descuento + "/100) = " + precioFoB);

            var precioInternacion = 0;

            if (tipo == "SW" || tipo == "SW-BT") {
                precioInternacion = precioFoB / (1 + impuesto / 100);
                //console.log("Precio Internacion = " + precioFoB + "/(1 + " + impuesto + "/100) = " + precioInternacion);
            }
            else if (tipo == "HW" || tipo == "HW-BT") {
                precioInternacion = precioFoB * (1 - impuesto / 100);
                //console.log("Precio Internacion = " + precioFoB + "*(1 - " + impuesto + "/100) = " + precioInternacion);
            }


            if ((tipo == "SW" || tipo == "HW")) {
                precioCliente = (precioInternacion * (1 + margen / 100)).toFixed(2);

                totalNeto = (precioInternacion * (1 + margen / 100) * cantidad).toFixed(2);
            }
            else if ((tipo == "SW-BT" || tipo == "HW-BT")) {
                precioCliente = (precioInternacion / (1 - margen / 100)).toFixed(2);

                totalNeto = (precioInternacion / (1 - margen / 100) * cantidad).toFixed(2);

                //console.log("Precio Cliente = (" + precioInternacion + "/(" + margen + "/100)) = " + precioCliente);
                //console.log("Total Neto = (" + precioInternacion + "/(" + margen + "/100)*" + cantidad + ") = " + precioCliente);
            }



            if (precioCliente > 0 && totalNeto > 0) {
                tr.find(".mPrecioCliente").val(precioCliente);
                tr.find(".mTotalNeto").val(totalNeto);
            }
        }
    }

    $(".mTipo").on("change", function () {
        var id = $(this).attr("id").split("_")[2];
        CalculaPrecio(parseInt(id) + 1);
        CalculaTotales();
    }
    );

    $(".mMaterial").on("change", function () {
        var id = $(this).attr("id").split("_")[2];
        CalculaPrecio(parseInt(id) + 1);
        CalculaTotales();
    }
    );

    $(".mCantidad").on("change", function () {
        var id = $(this).attr("id").split("_")[2];
        CalculaPrecio(parseInt(id) + 1);
        CalculaTotales();
    }
    );

    $(".mPrecioUnitario").on("change", function () {
        var id = $(this).attr("id").split("_")[2];
        CalculaPrecio(parseInt(id) + 1);
        CalculaTotales();
    }
    );

    $(".mDescuento").on("change", function () {
        var id = $(this).attr("id").split("_")[2];
        CalculaPrecio(parseInt(id) + 1);
        CalculaTotales();
    }
    );

    $(".mImpuesto").on("change", function () {
        var id = $(this).attr("id").split("_")[2];
        CalculaPrecio(parseInt(id) + 1);
        CalculaTotales();
    }
    );

    $("#Cotizacion_Margen").on("change", function () {
        for (i = 1; i < 100; i++) {
            CalculaPrecio(i);
        }
        CalculaTotales();
    }
    );


    function addRow() {
        var last = $("#tablaMateriales").find("tr.visible");
        if(last.length > 0) {
            console.log("last");
            last.last().next().addClass("visible").removeClass("oculta");
        }
        else {
            var first = $("#tr_1");
            console.log(first);
            first.addClass("visible").removeClass("oculta");
        }
    }

    $(function () {
        $("#Quote_FabricanteId").on("change", function () {
            var fabricanteId = $(this).val();
            $("#Quote_ContactoFabricanteId").empty();
            $("#Quote_ContactoFabricanteId").append("<option value=''>Seleccione contacto</option>");

            $.ajax({
                url: "/Cotizaciones/GetContactosFabricante",
                type: "GET",
                data: "fabricanteId=" + fabricanteId,
                success: function (data) {
                    $.each(data, function (i, item) {
                        $("#Quote_ContactoFabricanteId").append(`<option value="${item.contactoFabricanteId}">${item.nombre} ${item.apellido}</option>`);
                    });
                    $('#Quote_ContactoFabricanteId').addClass('selectpicker');
                    $('#Quote_ContactoFabricanteId').attr('data-live-search', 'true');
                    $('#Quote_ContactoFabricanteId').selectpicker('refresh');
                },
                error: function (error) {
                }
            });
        });
    });

    $(function () {
        $("#Cotizacion_CanalId").on("change", function () {
            var canalId = $(this).val();
            $("#Cotizacion_ContactoCanalId").empty();
            $("#Cotizacion_ContactoCanalId").append("<option value=''>Seleccione contacto</option>");

            $.ajax({
                url: "/Cotizaciones/GetContactosCanal",
                type: "GET",
                data: "canalId=" + canalId,
                success: function (data) {
                    $.each(data, function (i, item) {
                        $("#Cotizacion_ContactoCanalId").append(`<option value="${item.contactoCanalId}">${item.nombre} ${item.apellido}</option>`);
                    });
                    $('#Cotizacion_ContactoCanalId').addClass('selectpicker');
                    $('#Cotizacion_ContactoCanalId').attr('data-live-search', 'true');
                    $('#Cotizacion_ContactoCanalId').selectpicker('refresh');
                },
                error: function (error) {
                }
            });
        });
    });

    $(function () {
        $("#Cotizacion_ClienteFinalId").on("change", function () {
            var clienteId = $(this).val();
            $("#Cotizacion_ContactoClienteFinalId").empty();
            $("#Cotizacion_ContactoClienteFinalId").append("<option value=''>Seleccione contacto</option>");

            $.ajax({
                url: "/Cotizaciones/GetContactosClienteFinal",
                type: "GET",
                data: "clienteId=" + clienteId,
                success: function (data) {
                    $.each(data, function (i, item) {
                        $("#Cotizacion_ContactoClienteFinalId").append(`<option value="${item.contactoClienteFinalId}">${item.nombre} ${item.apellido}</option>`);
                    });
                    $('#Cotizacion_ContactoClienteFinalId').addClass('selectpicker');
                    $('#Cotizacion_ContactoClienteFinalId').attr('data-live-search', 'true');
                    $('#Cotizacion_ContactoClienteFinalId').selectpicker('refresh');
                },
                error: function (error) {
                }
            });
        });
    });

    $(document).ready(function () {
        $('.selectpicker').selectpicker();
    });
</script>